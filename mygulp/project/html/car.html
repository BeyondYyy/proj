<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>购物车</title>
    <script src="../jquery.1.12.4.js"></script>
    <script src="../jquery.banner.2.0.0.js"></script>
    <script src="../js/banner.js"></script>
    <link rel="stylesheet" href="../css/car.css">
    <link rel="stylesheet" href="../css/public.css">
    <!-- <style>
        table{text-align:center}
        img{width:80px;height:80px;}
    </style> -->
</head>
<body>
    <div id="top">
            <div class="margin">
                <h3><span>★</span>渔具专卖 特价户外用品</h3>
                <p class="p1">您好,游客 [<a href="html/login.html">登陆</a>] [<a href="html/register.html">注册</a>] <span>|</span><a href="">公告</a><span>|</span><a href="">手机版</a></p>
                <p class="p2">您好,<b></b><a href="##">退出</a></p>
            </div>
        </div>
        <script>
            var msg = localStorage.getItem("loginUser");
            console.log(msg)
            if(msg){
            $("#top").find(".p1").hide();
            $("#top").find(".p2").show();
            $("#top").find(".p2").find("b").html(JSON.parse(msg).user);
        }else{
            $("#top").find(".p1").show();
            $("#top").find(".p2").hide();
        }
    
        // 点击退出时,修改登录状态
        $("#top").find(".p2").find("a").click(function(){
            localStorage.removeItem("loginUser");
            $("#top").find(".p1").show();
            $("#top").find(".p2").hide();
        })
        </script>
    <!-- header -->
        <header class="margin">
            <div class="logo">
                <a href=""><img src="../images/logo.png" /></a>
            </div>
            <div class="search">
                <form>
                    <input type="text" class="txt" value="搜索商品 |">
                    <input type="submit" class="sub" value="搜索">
                </form>
                <p>
                    <b>热门搜索:</b>
                    <a href="">台钓</a>
                    <a href="">野钓</a>
                    <a href="">路亚</a>
                    <a href="">海钓</a>
                    <a href="">矶钓</a>
                </p>
            </div>
            <div class="add">
                <dl class="left">
                    <dt>
                        <i class="my bg"></i>
                        <a href="">我的渔美人</a>
                        <i class="xia bg"></i>
                    </dt>
                    <dd>
                        <p>您好,游客</p>
                        <div class="bot">
                            <ul class="left">
                                <li><a href="">我的订单</a></li>
                                <li><a href="">我的团购</a></li>
                                <li><a href="">我的咨询</a></li>
                            </ul>
                            <div class="line"></div>
                            <ul class="right">
                                <li><a href="">我的收藏</a></li>
                                <li><a href="">我的地址</a></li>
                                <li><a href="">我的优惠券</a></li>
                            </ul>
                        </div>
                    </dd>
                </dl>
                <dl class="right">
                    <dt>
                        <i class="che bg"></i>
                        <em>0</em>
                        <a href="html/car.html">购物车</a>
                        <i class="rig bg"></i>
                    </dt>
                    <dd>
                        <i class="zzz bg"></i>
                        <span>购物车中还没有商品,赶紧选购吧!</span>
                    </dd>
                </dl>
                <script>
                    $("dl.left").find("dt").hover(function(){
                        $(this).css({
                            background:"#fff",
                        }).siblings().css({
                            display:"block",
                            borderTop:0,
                            zIndex:999                       
                        }).siblings()
                        .css({
                            border:"#efefef 1px solid"
                        })
                        .find(".my").css({
                            backgroundPosition:"-121px -60px",
                        })
                    },function(){
                        $(this).css("background","#f7f7f7").siblings().css({
                            display:"none",
                            border:"#efefef 1px solid",
                        }).siblings()
                        .css({
                            border:"#efefef 1px solid"
                        })
                        .find(".my").css({
                            backgroundPosition:"-121px -30px"
                        })
                    })
                    $("dl.right").find("dt").hover(function(){
                        $(this).css({
                            borderBottom:0,
                            background:"#fff"
                        }).siblings().css({
                            display:"block",
                            boderTop:0,
                            zIndex:999
                        }).siblings()
                        .css({
                            border:"#efefef 1px solid"
                        })
                        .find(".che").css({
                            backgroundPosition:"-121px -120px"
                        })
                    },function(){
                        $(this).css("background","#f7f7f7").siblings().css({
                            border:"#efefef 1px solid",
                            display:"none"
                        }).siblings()
                        .find(".che").css({
                            backgroundPosition:"-121px -90px"
                        })
                    })
                </script>
            </div>
        </header>
    
<!-- nav -->
        <nav class="margin">
        <dl>
            <dt>分类</dt>
            <dd>
                <a href="">鱼竿</a>
                <i class="bg"></i>
                <div class="box">
                    <p class="p1">
                        <a href="">台钓竿</a>
                        <span>|</span>
                        <a href="">鲤竿</a>
                        <span>|</span>
                        <a href="">综合竿</a>
                        <span>|</span>
                        <a href="">罗飞竿</a>
                        <span>|</span>
                        <a href="">鲫竿</a>
                        <span>|</span>
                        <a href="">并继竿</a>
                    </p>
                    <p class="p2">
                        <a href="">手竿</a>
                        <span>|</span>
                        <a href="">短节竿</a>
                        <span>|</span>
                        <a href="">长竿</a>
                    </p>
                    <p class="p3">
                        <a href="">路亚竿</a>
                        <span>|</span>
                        <a href="">万能路亚竿</a>
                        <span>|</span>
                        <a href="">鲈鱼竿</a>
                        <span>|</span>
                        <a href="">翘嘴竿</a>
                        <span>|</span>
                        <a href="">雷强竿</a>
                        <span>|</span>
                        <a href="">飞蝇竿</a>
                        <span>|</span>
                        <a href="">海鲈竿</a>
                        <span>|</span>
                        <a href="">铁板竿</a>
                    </p>
                    <p class="p4">
                        <a href="">海竿</a>
                        <span>|</span>
                        <a href="">小海竿</a>
                        <span>|</span>
                        <a href="">远投竿</a>
                    </p>
                    <p class="p5">
                        <a href="">矶竿</a>
                    </p>
                    <p class="p6">
                        <a href="">前打竿</a>
                    </p>
                    <p class="p7">
                        <a href="">船竿</a>
                    </p>
                    <p class="p8">
                        <a href="">筏竿</a>
                    </p>
                </div>
            </dd>
            <dd>
                <a href="">鱼线</a>
                <i class="bg"></i>
                <div class="box">
                        <p class="p1">
                            <a href="">尼龙线</a>
                            <span>|</span>
                            <a href="">台钓线</a>
                            <span>|</span>
                            <a href="">路亚线</a>
                        </p>
                        <p class="p2">
                            <a href="">大马力</a>
                        </p>
                        <p class="p3">
                            <a href="">碳线</a>
                        </p>
                        <p class="p4">
                            <a href="">前导线</a>
                        </p>
                    </div>
            </dd>
            <dd>
                <a href="">鱼轮</a>
                <i class="bg"></i>
                <div class="box">
                        <p class="p1">
                            <a href="">纺车轮</a>
                        </p>
                        <p class="p2">
                            <a href="">水滴轮</a>
                        </p>
                        <p class="p3">
                            <a href="">鼓轮</a>
                        </p>
                        <p class="p4">
                            <a href="">筏轮</a>
                        </p>
                        <p class="p5">
                            <a href="">前打轮</a>
                        </p>
                        <p class="p6">
                            <a href="">渔轮配件</a>
                        </p>
                    </div>
            </dd>
            <dd>
                <a href="">鱼钩</a>
                <i class="bg"></i>
                <div class="box">
                        <p class="p1">
                            <a href="">台钓钩</a>
                            <span>|</span>
                            <a href="">袖钩</a>
                            <span>|</span>
                            <a href="">关东钩</a>
                            <span>|</span>
                            <a href="">伊豆钩</a>
                            <span>|</span>
                            <a href="">伊势尼</a>
                            <span>|</span>
                            <a href="">千又钩</a>
                            <span>|</span>
                            <a href="">丸世钩</a>
                            <span>|</span>
                            <a href="">台钓线组</a>
                        </p>
                        <p class="p2">
                            <a href="">路亚钩</a>
                            <span>|</span>
                            <a href="">曲柄钩</a>
                            <span>|</span>
                            <a href="">飞蝇钩</a>
                            <span>|</span>
                            <a href="">海钓钩</a>
                            <span>|</span>
                            <a href="">铅头钩</a>
                        </p>
                        <p class="p3">
                            <a href="">爆炸钩</a>
                        </p>
                    </div>
            </dd>
            <dd>
                <a href="">鱼漂</a>
                <i class="bg"></i>
                <div class="box">
                        <p class="p1">
                            <a href="">台钓漂</a>
                            <span>|</span>
                            <a href="">芦苇漂</a>
                            <span>|</span>
                            <a href="">巴尔衫木</a>
                            <span>|</span>
                            <a href="">纳米漂</a>
                            <span>|</span>
                            <a href="">七星漂</a>
                        </p>
                        <p class="p2">
                            <a href="">夜光漂</a>
                        </p>
                        <p class="p3">
                            <a href="">阿波漂</a>
                        </p>
                    </div>
            </dd>
            <dd>
                <a href="">鱼饵</a>
                <i class="bg"></i>
                <div class="box">
                    <p class="p1">
                        <a href="">商品饵</a>
                        <span>|</span>
                        <a href="">鲫鱼饵</a>
                        <span>|</span>
                        <a href="">鲤鱼饵</a>
                        <span>|</span>
                        <a href="">草鱼饵</a>
                        <span>|</span>
                        <a href="">鲢鳙饵</a>
                        <span>|</span>
                        <a href="">综合饵</a>
                        <span>|</span>
                        <a href="">状态饵</a>
                        <span>|</span>
                        <a href="">窝料</a>
                    </p>
                    <p class="p2">
                        <a href="">小药</a>
                    </p>
                    <p class="p3">
                        <a href="">软饵</a>
                        <span>|</span>
                        <a href="">软虫</a>
                        <span>|</span>
                        <a href="">雷蛙</a>
                        <span>|</span>
                        <a href="">假鱿鱼</a>
                    </p>
                    <p class="p4">
                        <a href="">硬饵</a>
                        <span>|</span>
                        <a href="">亮片</a>
                        <span>|</span>
                        <a href="">米诺</a>
                        <span>|</span>
                        <a href="">爬波</a>
                        <span>|</span>
                        <a href="">铅笔</a>
                        <span>|</span>
                        <a href="">VIB</a>
                        <span>|</span>
                        <a href="">胡须佬</a>
                        <span>|</span>
                        <a href="">铁板饵</a>
                    </p>
                    <p class="p5">
                        <a href="">矶竿</a>
                    </p>
                </div>
            </dd>
            <dd>
                <a href="">配件</a>
                <i class="bg"></i>
                <div class="box">
                <p class="p1">
                    <a href="">鱼竿配件</a>
                    <span>|</span>
                    <a href="">铃铛</a>
                    <span>|</span>
                    <a href="">竿止</a>
                    <span>|</span>
                    <a href="">失手绳</a>
                    <span>|</span>
                    <a href="">导环</a>
                    <span>|</span>
                    <a href="">竿稍绳</a>
                </p>
                <p class="p2">
                    <a href="">线组配件</a>
                    <span>|</span>
                    <a href="">八字环</a>
                    <span>|</span>
                    <a href="">转换别针</a>
                    <span>|</span>
                    <a href="">太空豆</a>
                    <span>|</span>
                    <a href="">铅坠</a>
                    <span>|</span>
                    <a href="">铅皮座</a>
                    <span>|</span>
                    <a href="">绕线板</a>
                    <span>|</span>
                    <a href="">诱饵笼</a>
                </p>
                <p class="p3">
                    <a href="">浮标配件</a>
                    <span>|</span>
                    <a href="">漂座</a>
                    <span>|</span>
                    <a href="">棉线结</a>
                    <span>|</span>
                    <a href="">卡拉棒</a>
                    <span>|</span>
                    <a href="">挡豆</a>
                    <span>|</span>
                    <a href="">荧光棒</a>
                </p>
                <p class="p4">
                    <a href="">渔具盒</a>
                    <span>|</span>
                    <a href="">主线盒</a>
                    <span>|</span>
                    <a href="">浮漂盒</a>
                    <span>|</span>
                    <a href="">配件盒</a>
                    <span>|</span>
                    <a href="">路亚盒</a>
                </p>
            </dd>
            <dd>
                <a href="">装备</a>
                <i class="bg"></i>
                <div class="box">
                    <p class="p1">
                        <a href="">钓箱</a>
                    </p>
                    <p class="p2">
                        <a href="">钓箱配件</a>
                        <span>|</span>
                        <a href="">三件套</a>
                        <span>|</span>
                        <a href="">拉饵盘</a>
                        <span>|</span>
                        <a href="">氧气泵</a>
                        <span>|</span>
                        <a href="">钓椅配件</a>
                    </p>
                    <p class="p3">
                        <a href="">支架</a>
                        <span>|</span>
                        <a href="">手竿架</a>
                        <span>|</span>
                        <a href="">海竿架</a>
                        <span>|</span>
                        <a href="">船筏竿架</a>
                        <span>|</span>
                        <a href="">炮台</a>
                        <span>|</span>
                        <a href="">伞架</a>
                        <span>|</span>
                        <a href="">灯架</a>
                        <span>|</span>
                        <a href="">饵盘架</a>
                    </p>
                    <p class="p4">
                        <a href="">渔具包</a>
                    </p>
                    <p class="p5">
                        <a href="">钓椅</a>
                    </p>
                    <p class="p6">
                        <a href="">钓台</a>
                    </p>
                    <p class="p7">
                        <a href="">鱼护</a>
                    </p>
                    <p class="p8">
                        <a href="">抄网</a>
                    </p>
                    <p class="p9">
                        <a href="">钓鱼桶</a>
                    </p>
                    <p class="p10">
                        <a href="">太阳伞</a>
                    </p>
                </div>
            </dd>
            <dd>
                <a href="">工具</a>
                <i class="bg"></i>
                <div class="box">
                    <p class="p1">
                        <a href="">照明</a>
                        <span>|</span>
                        <a href="">手电筒</a>
                        <span>|</span>
                        <a href="">夜钓灯</a>
                        <span>|</span>
                        <a href="">头灯</a>
                        <span>|</span>
                        <a href="">探照灯</a>
                        <span>|</span>
                        <a href="">野营灯</a>
                        <span>|</span>
                        <a href="">锂电池</a>
                        <span>|</span>
                        <a href="">充电器</a>
                        <span>|</span>
                        <a href="">太阳能灯</a>
                    </p>
                    <p class="p2">
                        <a href="">探鱼器</a>
                    </p>
                    <p class="p3">
                        <a href="">打窝船</a>
                    </p>
                    <p class="p4">
                        <a href="">控鱼器</a>
                    </p>
                    <p class="p5">
                        <a href="">路亚钳</a>
                    </p>
                    <p class="p6">
                        <a href="">绑钩器</a>
                    </p>
                    <p class="p7">
                        <a href="">脱钩器</a>
                    </p>
                    <p class="p8">
                        <a href="">剪刀</a>
                    </p>
                    <p class="p9">
                        <a href="">肚顶</a>
                    </p>
                    <p class="p10">
                        <a href="">黄鳝钓具</a>
                    </p>
                    <p class="p11">
                        <a href="">辅助工具</a>
                    </p>
                </div>
            </dd>
            <dd>
                <a href="">服装</a>
                <i class="bg"></i>
                <div class="box">
                    <p class="p1">
                        <a href="">冲锋衣</a>
                    </p>
                    <p class="p2">
                        <a href="">救生衣</a>
                    </p>
                    <p class="p3">
                        <a href="">防晒衣</a>
                    </p>
                    <p class="p4">
                        <a href="">太阳帽</a>
                    </p>
                    <p class="p5">
                        <a href="">速干衣</a>
                    </p>
                    <p class="p6">
                        <a href="">雨衣</a>
                    </p>
                    <p class="p7">
                        <a href="">下水裤</a>
                    </p>
                    <p class="p8">
                        <a href="">手套</a>
                    </p>
                    <p class="p9">
                        <a href="">眼镜</a>
                    </p>
                    <p class="p10">
                        <a href="">手表</a>
                    </p>
                </div>
            </dd>
            <dd>
                <a href="">户外</a>
                <i class="bg"></i>
                <div class="box">
                    <p class="p1">
                        <a href="">帐篷</a>
                        <span>|</span>
                        <a href="">单层账</a>
                        <span>|</span>
                        <a href="">双层账</a>
                        <span>|</span>
                        <a href="">天幕</a>
                        <span>|</span>
                        <a href="">帐篷配件</a>
                    </p>
                    <p class="p2">
                        <a href="">防潮垫</a>
                    </p>
                    <p class="p3">
                        <a href="">睡袋</a>
                    </p>
                    <p class="p4">
                        <a href="">充气枕</a>
                    </p>
                    <p class="p5">
                        <a href="">吊床</a>
                    </p>
                    <p class="p6">
                        <a href="">折叠床</a>
                    </p>
                    <p class="p7">
                        <a href="">休闲包</a>
                    </p>
                    <p class="p8">
                        <a href="">烧烤</a>
                        <span>|</span>
                        <a href="">烤炉</a>
                        <span>|</span>
                        <a href="">木炭</a>
                        <span>|</span>
                        <a href="">烤网</a>
                        <span>|</span>
                        <a href="">烧烤配件
                        </a>
                    </p>
                    <p class="p9">
                        <a href="">炊具</a>
                        <span>|</span>
                        <a href="">炉具</a>
                        <span>|</span>
                        <a href="">厨具</a>
                    </p>
                    <p class="p10">
                        <a href="">工兵铲</a>
                    </p>
                </div>
            </dd>
            <dd>
                <a href="">渔网</a>
                <i class="bg"></i>
                <div class="box">
                        <p class="p2">
                            <a href="">撒网</a>
                        </p>
                        <p class="p3">
                            <a href="">粘网</a>
                        </p>
                        <p class="p4">
                            <a href="">地笼</a>
                        </p>
                    </div>
                </dd>
            </dl>
            <script>
                $("nav").find("dl").hover(function(){
                    $(this).find("dd")
                    .css({
                        display:"block"
                    })
                },function(){
                    $(this).find("dd")
                    .css({
                        display:"none"
                    })
                })
            </script>
            <ul>
                <li><a href="../index.heml">首页</a></li>
                <li><a href="goods.html">鱼竿</a></li>
                <li><a href="">鱼线</a></li>
                <li><a href="">鱼轮</a></li>
                <li><a href="">鱼钩</a></li>
                <li><a href="">鱼漂</a></li>
                <li><a href="">鱼饵</a></li>
                <li><a href="">配件</a></li>
                <li><a href="">特价</a></li>
                <li><a href="">优惠券</a></li>
            </ul>
            <script>
                $("nav").find("dd").hover(function(){
                    $(this).css({
                        
                        // borderBottom:"1px #f7f7f7 solid",
                        background:"#fff",
                        boxShadow:"0 0 10px #999"
                    }).find(".box").css({
                        display:"block"
                    })
                },function(){
                    $(this).css({
                        boxShadow:"none"
                    }).find(".box").css({
                        display:"none"
                    })
                })
            </script>
        </nav>
<!-- mian -->
    <main>
        <table border="1" cellspacing="0" width="800" align="center">
            <thead>
                <tr>
                    <th>图片</th>
                    <th>名字</th>
                    <th>价格</th>
                    <th>数量</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="5">购物车为空</td>
                </tr>
                <tr>
                    <td><img src="../images/g2.jpg"></td>
                    <td>名字</td>
                    <td>价格</td>
                    <td><input type="number" value="10"></td>
                    <td>删除</td>
                </tr>
            </tbody>
        </table>

    </main>
</body>
<script src="../libs/ajax.js"></script>
<script src="../libs/cookie.js"></script>
<script>
    class Car{
        constructor(){
            this.tbody = document.querySelector("tbody");
            console.log(this.tbody)
            this.url = "http://localhost/mygulp/project/data/goods.json";
            console.log(this.url)
            // 1.先请求所有数据
            this.load();
            // D1.绑定事件
            this.addEvent()
        }
        addEvent(){
            var that = this;
            // D2.采用事件委托绑定删除的事件
            this.tbody.addEventListener("click",function(eve){
                if(eve.target.className == "del"){
                    // D3.获取点击商品的id
                    that.id = eve.target.parentNode.getAttribute("index");
                    // D4.删除DOM元素
                    eve.target.parentNode.remove();
                    // D5.删除cookie中的数据
                    that.changeCookie(function(i){
                        that.goods.splice(i,1)
                    });
                }
            })
            // U1.采用事件委托绑定修改数量的事件
            this.tbody.addEventListener("input",function(eve){
                if(eve.target.className == "num"){
                    // U2.获取修改数量对应的商品的id
                    that.id = eve.target.parentNode.parentNode.getAttribute("index");
                    // U3.获取修改之后的实时数量
                    // that.num = eve.target.value;
                    // U4.修改cookie中的数据
                    that.changeCookie(function(i){
                        that.goods[i].num = eve.target.value;
                    });
                }
            })
        }
        changeCookie(callback){
            // 先遍历cookie中读取出来的数据
            var i = 0;
            this.goods.some((val,index)=>{
                // 拿到与点击相同的数据，结束
                i = index;
                return val.id == this.id;
            })
            callback(i);
            // U5.最后要把操作之后的数据，再设置给cookie
            setCookie("goods",JSON.stringify(this.goods));
        }
        load(){
            var that = this;
            ajaxGet(this.url,function(res){
                that.res = JSON.parse(res);
                // 2.读取cookie
                that.getCookie()
            })
        }
        getCookie(){
            this.goods = getCookie("goods") ? JSON.parse(getCookie("goods")) : [];

            // 3.开始比对数据，渲染页面
            this.display();
        }
        display(){
            var str = "";
            // 遍历所有数据
            this.res.forEach((resVal)=>{
                // 遍历cookie中的数据
                this.goods.forEach((goodsVal)=>{
                    // 比较,一致,渲染对应数据
                    if(resVal.goodsId == goodsVal.id){
                        str += `<tr index="${resVal.goodsId}">
                                    <td><img src="${resVal.url}"></td>
                                    <td>${resVal.price}</td>
                                    <td><input class="num" type="number" value="${goodsVal.num}" min=1></td>
                                    <td class="del">删除</td>
                                </tr>`;
                    }
                })
            })
            console.log(str);
            this.tbody.innerHTML = str;
        }
    }

    new Car();
</script>